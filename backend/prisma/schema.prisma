datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["linux-musl", "debian-openssl-3.0.x"]
}

model User {
  id               Int               @id @default(autoincrement())
  email            String
  password         String
  role             String            // VET or CLIENT
  vet              Vet?              // Relation to Vet profile
  client           Client?           // Relation to Client profile
  inbox            Inbox[]
  feedbackTopics   FeedbackTopic[]   @relation("TopicAuthor")
  feedbackComments FeedbackComment[] @relation("CommentAuthor")

  @@unique([email, role])
}

model Vet {
  id           Int           @id @default(autoincrement())
  name         String
  user         User          @relation(fields: [userId], references: [id])
  userId       Int           @unique
  appointments Appointment[]
}

model Client {
  id   Int   @id @default(autoincrement())
  name String
  user User  @relation(fields: [userId], references: [id])
  userId      Int   @unique
  pets Pet[]
}

model Pet {
  id           Int           @id @default(autoincrement())
  name         String
  species      String
  owner        Client        @relation(fields: [ownerId], references: [id])
  ownerId      Int
  appointments Appointment[]
}

model Appointment {
  id                 Int      @id @default(autoincrement())
  date               DateTime
  status             String   @default("PENDING") // PENDING, SCHEDULED, COMPLETED, CANCELED
  cancellationReason String?
  pet                Pet      @relation(fields: [petId], references: [id])
  petId              Int
  vet                Vet      @relation(fields: [vetId], references: [id])
  vetId              Int
  inboxMessages      Inbox[]
}

model Inbox {
  id            Int          @id @default(autoincrement())
  userId        Int
  user          User         @relation(fields: [userId], references: [id])
  message       String
  status        String   // EDITED, DELETED, NEW
  isFavorite    Boolean      @default(false)
  createdAt     DateTime     @default(now())
  appointment   Appointment? @relation(fields: [appointmentId], references: [id])
  appointmentId Int?
}

model FeedbackTopic {
  id          Int               @id @default(autoincrement())
  title       String
  description String
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  author      User              @relation("TopicAuthor", fields: [authorId], references: [id])
  authorId    Int
  comments    FeedbackComment[]
}

model FeedbackComment {
  id        Int           @id @default(autoincrement())
  content   String
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  edited    Boolean       @default(false)
  author    User          @relation("CommentAuthor", fields: [authorId], references: [id])
  authorId  Int
  topic     FeedbackTopic @relation(fields: [topicId], references: [id])
  topicId   Int
}